parameters$e
parameters
e[1]
e[2]
e[3]
collapsed_result_blunting
### MAIN PAPER ####################################################################################
## TABLE 2 (6 runs)
#original run
source(paste(getwd(),"/(0)_command_desk.R",sep=""))
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/FleetAdmiral.R", echo=TRUE)
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(print)_2022_05_10.R", echo=TRUE)
### SUPPLEMENTARY MATERIAL ################################################################
#S6.1 Infant PCV cov and effectiveness #__________________________________________________
InfantPCV_tracker = data.frame()
#(A/B) PCV coverage
pcv_coverage = "sensitivity_DTP"
results_warehouse[[1]]
time.end.FleetAdmiral-time.start.FleetAdmiral
2135.75/3600
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/FleetAdmiral.R", echo=TRUE)
### MAIN PAPER ####################################################################################
## TABLE 2 (6 runs)
results_warehouse[[1]][[1]]
results_warehouse[[2]]
## TABLE 3 (output of original)
results_warehouse[[1]][[4]]
## TABLE 4 (output of original)
results_warehouse[[1]][[5]]
## TABLE 5 (blunting)
results_warehouse[[1]][[2]]
results_warehouse[[1]][[5]] %>% filter(category == 'death')
results_warehouse[[3]]
e
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(0)_command_desk.R", echo=TRUE)
results_warehouse[[1]]
PCV_start_bracket
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(0)_command_desk.R", echo=TRUE)
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(0)_command_desk.R", echo=TRUE)
prevalence_summary
initial_fit
ari
beta
ari
source(paste(getwd(),"/(4)_time_step.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
inital_fit - prevalence_summary
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
beta = 0.000835
source(paste(getwd(),"/(4)_time_step.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
ARI_setting
maternal_vaccine_on
maternal_vaccine_on
maternal_vaccine_on = "N"
source(paste(getwd(),"/(4)_time_step.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
maternal_vaccine_on
inital_infection[1]
ari
ARI_import
ari*ARI_import[,2]
inital_infection
initial_fit = c(100*inital_infection[1],
100*inital_infection[7],
100*inital_infection[13],
100*inital_infection[25],
100*inital_infection[26])
c(100*inital_infection[1],
+                 100*inital_infection[7],
+                 100*inital_infection[13],
+                 100*inital_infection[25],
+                 100*inital_infection[26])
>
c(100*inital_infection[1],
+                 100*inital_infection[7],
+                 100*inital_infection[13],
+                 100*inital_infection[25],
+                 100*inital_infection[26])
ari*ARI_import[,2]
initial_fit
prevalence_summary
beta
ari
beta = 0.000619
source(paste(getwd(),"/(4)_time_step.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
PCV_start_bracket
#       (2/4) Toggles for sensitivity analysis
####################################################################
time_step =  1           # model time-step (ODE timestep)
ageing_step = 30         # how frequently ageing is implemented
ageing_toggle = "cohort" # options:"cohort","daily"
model_years = 1  # how many years should the model run for?
complete_model_runs=1
ARI_setting="DHS_2019"
ari = 0.167  # proportion ARI attributable to pneumococcal, options: 0.135 (IPD probe), 0.167 (average), 0.198 (AOM probe), otherwise run (9) beta optimisation!
pcv_effectiveness = "2021_model"  # options: 2019_model, 2021_model, 2021_random_sample 2021_upper_serotype_cov 2021_lower_serotype_cov
PCV_start_bracket = c(3,4,5)      # options: c(3,5,7) original paper or c(3,4,5) revised with DHS timeliness analysis
pcv_coverage = "2019_DHS"           # options: 2017_MICS, 2019_DHS, 2019_DHS_random_sample, 2019_DHS_lower_bound, 2019_DHS_upper_bound, sensitivity_DTP, sensitivity_MCV, absent
pop_distribution = "uniform"        # choose between "uniform" or "census"
death_distribution = "oldest_only"  #choose between = "oldest_only" or "2019_DHS"
pop_growth_rate =  1              # 1 confers to no growth, estimate is 1.02439 from 2015 Population and Housing Census('Thematic report on population projections')
carriage_adj = 1                  # adjustment for carriage
recov_adj = 1                     # adjustment for recovery
recov_setting = "2021_model"      # options: 2019_model 2021_model 2021_lower 2021_upper
carriage_setting = "2022_model"        # options: 2019_model 2021_model 2022_model
mat_waning = "standard"           # choose between "standard", "slower" and "faster"
#blunting options 0.05 (possible), 0.15 (unlikely), 0.30 (very unlikely)
blunting_temp = 0                 # reduction in PCV efficacy as a result of maternal antibody presence
blunting_long = 0                 # COMEBACK, need full model instead of quick workaround
burden_disease ="base" #options: "base","LB","UB"
covid_sensitivity = "off"          #options: "on" or "off"
maternal_vaccine_on
source(paste(getwd(),"/(4)_time_step.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
PCV_start_bracket
PCV_start_bracket
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
source(paste(getwd(),"(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(1)_load_model_param.R", echo=TRUE)
carriage
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
Is
Iv1
View(Iv1)
num_age_groups
sum(initial_fit - prevalence_summary)
initial_fit - prevalence_summary
(initial_fit - prevalence_summary)^2
(initial_fit - prevalence_summary)^2)sum()
sum(initial_fit - prevalence_summary)^2)sum()
sum(initial_fit - prevalence_summary)^2)
sum((initial_fit - prevalence_summary)^2)
time.start=proc.time()[[3]] #let's see how long this runs for
minimise_this <- function(beta_input){
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26]
)
return(fit)
}
save_optim = optim(0.000619,fn=minimise_this,gr=NULL)
save_optim
time.end=proc.time()[[3]]
time.end-time.start
time.start=proc.time()[[3]] #let's see how long this runs for
minimise_this <- function(beta_input){
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26]
)
fit = sum((initial_fit - prevalence_summary)^2)
return(fit)
}
save_optim = optim(0.000619,fn=minimise_this,gr=NULL)
save_optim
time.end=proc.time()[[3]]
time.end-time.start
### (C) Contact matrix
contact_matrix <- read.csv("contact_matrix_v1.csv",header=TRUE)
contact_matrix = contact_matrix[-1]
beta
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
library(deSolve)
library(dplyr)
library(tidyverse)
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
### (C) Contact matrix
contact_matrix <- read.csv("contact_matrix_v2.csv",header=TRUE)
contact_matrix = contact_matrix[-1]
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
contact_matrix
### (C) Contact matrix
contact_matrix <- read.csv("contact_matrix_v1.csv",header=TRUE)
contact_matrix = contact_matrix[-1]
contact_matrix
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
### (C) Contact matrix
contact_matrix <- read.csv("contact_matrix_v2.csv",header=TRUE)
contact_matrix = contact_matrix[-1]
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
contact_matrix
rowSums(contact_matrix)
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(1)_load_model_param.R", echo=TRUE)
#source(paste(getwd(),"/(4)_time_step.R",sep=""))
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
initial_fit
initial_fit - prevalence_summary
sum(initial_fit - prevalence_summary)
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(1)_load_model_param.R", echo=TRUE)
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(1)_load_model_param.R", echo=TRUE)
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(1)_load_model_param.R", echo=TRUE)
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(9)_beta_optimisation_loop.R", echo=TRUE)
prevalence_summary
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(1)_load_model_param.R", echo=TRUE)
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
library(deSolve)
library(dplyr)
library(tidyverse)
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(1)_load_model_param.R", echo=TRUE)
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
beta
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(1)_load_model_param.R", echo=TRUE)
source(paste(getwd(),"/(function)_NO_MATERNAL_model_run.R",sep=""))
prevalence_summary = c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
prevalence_summary
beta
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(9)_beta_optimisation_loop.R", echo=TRUE)
beta
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(0)_command_desk.R", echo=TRUE)
prevalence_summary
c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
maternal_vaccine_on = "N"
source(paste(getwd(),"/(2)_configure_inital_state.R",sep=""))
source(paste(getwd(),"/(3)_pneum_ode_function.R",sep=""))
if (ageing_toggle == "cohort"){source(paste(getwd(),"/(4)_time_step.R",sep=""))}
else if (ageing_toggle == "daily"){source(paste(getwd(),"/(4)_time_step_incremental.R",sep=""))}
if (run_number == 1){
incid_1000PY_baseline_log <- tail(incidence_1000PY,1)
}
if (run_number > 1){
incid_1000PY_baseline_log <-rbind(incid_1000PY_baseline_log,tail(incidence_1000PY,1))
}
c(sum(prevalence[c(1:6)])/6,
sum(prevalence[c(7:12)])/6,
sum(prevalence[c(13:24)])/12,
prevalence[25],
prevalence[26])
library(deSolve)
library(dplyr)
library(tidyverse)
#S6.3 population structure  sensitivity analysis_______________________________________________
#S6.3.1 age structure
pop_distribution = "census"
source(paste(getwd(),"/(function)_full_model_run.R",sep=""))
#setting age structure
P_inital =(rep(0,num_age_groups))
if (pop_distribution == "uniform"){ #uniform distribution according to standard life expectancy
for (i in 1:24){P_inital[i]=N/(life_expectancy*12)}
P_inital[num_age_groups-1]=N*3/life_expectancy
P_inital[num_age_groups]=N*(life_expectancy-5)/life_expectancy
} else if (pop_distribution=="census") { #age distribution from 2019 DHS survey table 2.8 (aligns with 2015 Population and Housing Census)
for (i in 1:24){P_inital[i]=(0.029*N)/24}
P_inital[num_age_groups-1]=N*0.087 # 2-5 years
P_inital[num_age_groups]=N*0.855 #5+ age group
}
if (sum(P_inital) != N){stop('population not configured correctly!')}
sum(P_inital)
num_age_groups
#setting age structure
P_inital =(rep(0,num_age_groups))
if (pop_distribution == "uniform"){ #uniform distribution according to standard life expectancy
for (i in 1:24){P_inital[i]=N/(life_expectancy*12)}
P_inital[num_age_groups-1]=N*3/life_expectancy
P_inital[num_age_groups]=N*(life_expectancy-5)/life_expectancy
} else if (pop_distribution=="census") { #age distribution from 2019 DHS survey table 2.8 (aligns with 2015 Population and Housing Census)
for (i in 1:24){P_inital[i]=(0.058*N)/24}
P_inital[num_age_groups-1]=N*0.087 # 2-5 years
P_inital[num_age_groups]=N*0.855 #5+ age group
}
if (sum(P_inital) != N){stop('population not configured correctly!')}
sum(P_inital)
N
#setting age structure
P_inital =(rep(0,num_age_groups))
if (pop_distribution == "uniform"){ #uniform distribution according to standard life expectancy
for (i in 1:24){P_inital[i]=N/(life_expectancy*12)}
P_inital[num_age_groups-1]=N*3/life_expectancy
P_inital[num_age_groups]=N*(life_expectancy-5)/life_expectancy
} else if (pop_distribution=="census") { #age distribution from 2019 DHS survey table 2.8 (aligns with 2015 Population and Housing Census)
for (i in 1:24){P_inital[i]=(0.058*N)/24}
P_inital[num_age_groups-1]=N*0.087 # 2-5 years
P_inital[num_age_groups]=N*0.855 #5+ age group
}
if (round(sum(P_inital)) != N){stop('population not configured correctly!')}
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/FleetDeputy.R", echo=TRUE)
mu_import
sum(mu_import[,3])
save_fleetDeputy = results_warehouse
#S6.3.2 age-specific mortality
death_distribution = "2019_DHS"
source(paste(getwd(),"/(function)_full_model_run.R",sep=""))
sensitivity_mortality= collapsed_result_main
results_warehouse[[7]] = sensitivity_mortality
death_distribution = "oldest_only"
#S6.3.1 population growth
pop_growth_rate = 1
source(paste(getwd(),"/(function)_full_model_run.R",sep=""))
sensitivity_pop_growth = collapsed_result_main
results_warehouse[[8]] = sensitivity_pop_growth
pop_growth_rate =  1
#______________________________________________________________________________________________
#S5.2 Length of Maternally derived Immunity
mat_wan_tracker = data.frame()
wan_list = c('slower','standard','faster')
for (docket in 1:length(wan_list)){
mat_waning = wan_list[docket]
source(paste(getwd(),"/(function)_full_model_run.R",sep=""))
rows = collapsed_result_blunting %>% mutate(wan_speed = mat_waning)
mat_wan_tracker = rbind(mat_wan_tracker,rows)
}
mat_waning = "standard"
results_warehouse[[9]] = mat_wan_tracker
## TABLE 5 (blunting)
round(results_warehouse[[1]][[2]])
### SUPPLEMENTARY MATERIAL ###########################################################################
#S6.1 Infant PCV cov and effectiveness
results_warehouse[[4]]
### SUPPLEMENTARY MATERIAL ###########################################################################
#S6.1 Infant PCV cov and effectiveness
workshop = results_warehouse[[4]]
workshop[,c(1:4)] = round(workshop[,c(1:4)])
workshop = na.omit(workshop)
workshop
#S6.2 COVID_19 sensitivity analysis
results_warehouse[[5]]
#S6.3 population structure  sensitivity analysis
#S6.3.1 age structure
results_warehouse[[6]]
#S6.3.2 age-specific mortality
results_warehouse[[7]]
#S6.3.1 population growth
results_warehouse[[8]]
results_warehouse[[9]]
#S5.2 Length of Maternally derived Immunity
workshop = results_warehouse[[9]]
workshop[,c(1:4)] = round(workshop[,c(1:4)])
workshop = na.omit(workshop)
workshop
pop_growth_rate = 1.02439
source(paste(getwd(),"/(function)_full_model_run.R",sep=""))
sensitivity_pop_growth = collapsed_result_main
results_warehouse[[8]] = sensitivity_pop_growth
pop_growth_rate =  1
#S6.3.1 population growth
results_warehouse[[8]]
### MAIN PAPER ####################################################################################
## TABLE 2 (6 runs)
round(results_warehouse[[1]][[1]])
results_warehouse[[1]][[1]]
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(0)_command_desk.R", echo=TRUE)
ari
collapsed_result_main
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(9)_beta_optimisation_loop.R", echo=TRUE)
beta
ari
source("C:/Users/u6044061/Documents/PhD/Research/1_maternal_pneumococcal/code/GitHub_mat_pneumococcal/(0)_command_desk.R", echo=TRUE)
